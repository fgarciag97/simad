<?php $this->assign('title', 'Ordenamiento de Pago'); ?>

<?php
    $n = 10 - strlen($requisicion);
    $req = '';
    for($i=0; $i < $n; $i++){
        $req .= "0";
    }
    $req .= $requisicion; 
?>

<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->

<?php if($data['status3'] == true){ echo $this->Form->create(@$orden, ['class'=>'well']);?>
	
	<!---------------------------------------------------------------------------------------------------------------------------->

	<?php if ($data['status4'] == true){ ?>
		    <center>
		    	<p style="color: green"> <strong> ORDEN APROBADA </strong> </p>
		    </center>
	<?php } ?>
			<center>
		    	<h4 style="color: green"> <strong> 4ta PARTE </strong> </h4>
		    </center>

	<!---------------------------------------------------------------------------------------------------------------------------->

	<?= $this->Form->hidden('id_requisicion', ['type' => 'text', 'label' => false, 'required', 'value' => $requisicion, 'id' => 'id_requisicion']); ?>

	<?php 
		if(@$data['concepto_mod'] != ''){
			$concepto = @$data['concepto_mod'];
		}else{
			$concepto = @$data['concepto'];
		}
	?> 

	<?php if(count($registros4) == 0){ ?>

		<table class="table table-responsive">
			<tr>
				<td>Observación <?= $this->Form->textarea('observacion', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'rows' => 2, 'onkeyup' => 'mayus(this);']); ?></td>
			</tr>
		</table>

		<table class="table table-responsive">
			<tr>
				<td>Nº de Factura <?= $this->Form->input('n_factura', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off']); ?></td>
				<td>Nº de Control <?= $this->Form->input('n_control', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off']); ?></td>
				<td>Fecha <?= $this->Form->input('fecha', ['label' => false, 'type' => 'date', 'class'=> 'form-control', 'required', 'dateFormat' => 'YMD', 'monthNames' => $meses, 'minYear'=>ANO_FISCAL, 'maxYear'=>ANO_FISCAL]); ?></td>
				<?= $this->Form->hidden('fraccion', ['label' => false, 'type' => 'text', 'required', 'value' => 4, 'readonly']); ?>
			</tr>
		</table>
	<?php }else{ ?>

		<table class="table table-responsive">
			<tr>
				<td>Observación <?= $this->Form->textarea('observacion', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'rows' => 2, 'onkeyup' => 'mayus(this);', 'value' => $registros4[0]['observacion']]); ?></td>
			</tr>
		</table>

		<table class="table table-responsive">
			<tr>
				<td>Nº de Factura <?= $this->Form->input('n_factura', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'readonly', 'value' => $registros4[0]['n_factura']]); ?></td>
				<td>Nº de Control <?= $this->Form->input('n_control', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'readonly', 'value' => $registros4[0]['n_control']]); ?></td>
				<td>Fecha <?= $this->Form->input('fecha', ['label' => false, 'type' => 'date', 'class'=> 'form-control', 'required pattern'=>'[A-Z]{3}[0-9]{4}',  'value' => date_format($registros4[0]['fecha'], "Y/m/d"), 'monthNames' => $meses, 'minYear'=>ANO_FISCAL, 'maxYear'=>ANO_FISCAL, 'readonly']); ?></td>
				<?= $this->Form->hidden('fraccion', ['label' => false, 'type' => 'text', 'required', 'value' => 4, 'readonly']); ?>
			</tr>
		</table>
	<?php } ?>

	<!---------------------------------------------------------------------------------------------------------------------------->
	

	<table class="table table-responsive">
		<thead style="text-align: center;">
	        <tr>
			    <td> <label> Calculo de: </label></td>
			    <td> <label> Porcenataje: </label></td>
			    <td> <label> Monto BsS </label></td>
			    <td> Acción </td>
			</tr>
		</thead>

		<?php

			if(isset($compra[0]['total'])){
				$neto = number_format(($compra[0]['total'] + ($compra[0]['total'] * 0.16)), 2, '.', '');
			}else if(isset($servicio[0]['total'])){
				$neto = number_format(($servicio[0]['total'] + ($servicio[0]['total'] * 0.16)), 2, '.', '');
			}
			$restante = $neto;
		?>

		<?php foreach ($registros4 as $reg) { ?>

			<tr style="text-align: center;">
			    	<td>
			    		<?= $reg->tipo_calculo; ?>
			    	</td>
			    	<td>
			    		<?= ($reg->tipo_porcentaje * 100) . "%" ; ?>
			    	</td>
			    	<td>
			    		<?= number_format($reg->bs, 2, ',', '.') ?>
			    	</td>
			    	<td>
			    		<?php 
				    		if($data['status4'] == false){
				    			echo $this->Html->Link('Eliminar', ['action' => 'deletecompra', $reg->id, $requisicion, $tipo], ['confirm' => __('Desea eliminar este Items?'), 'class' => 'btn btn-danger btn-xs']);
				    		}else{
				    			echo $this->Html->Link('Eliminar', ['action' => 'deletecompra', $reg->id, $requisicion], ['confirm' => __('Desea eliminar este Items?'), 'class' => 'btn btn-danger btn-xs', 'disabled']);
				    		}
			    		?>
			    	</td>
			</tr>
		<?php } ?>
		
		<?php  if($data['status4'] == false): ?>
			<tr style="text-align: center;">
			    	<td>
			    		<?= $this->Form->select('tipo_calculo', $calculo, ['empty' => '--Seleccione--', 'class'=> 'form-control', 'required', 'label' => false, 'escape' => false, 'id' => 'tipo_calculo']); ?>
			    	</td>
			    	<td>
			    		<?= $this->Form->select('tipo_porcentaje', [
			    			'0.008' => '0.80%',
			    			'0.01' => '1%',
			    			'0.02' => '2%',
			    			'0.03' => '3%',
			    			'0.04' => '4%',
			    			'0.05' => '5%',
			    			'0.06' => '6%',
			    			'0.07' => '7%',
			    			'0.08' => '8%',
			    			'0.09' => '9%',
			    			'0.10' => '10%',
			    			'0.15' => '15%',
			    			'0.20' => '20%',
			    			'0.25' => '25%',
			    			'0.30' => '30%',
			    			'0.35' => '35%',
			    			'0.40' => '40%',
			    			'0.45' => '45%',
			    			'0.50' => '50%',
			    			'0.55' => '55%',
			    			'0.60' => '60%',
			    			'0.65' => '65%',
			    			'0.70' => '70%',
			    			'0.75' => '75%',
			    			'0.80' => '80%',
			    			'0.85' => '85%',
			    			'0.90' => '90%',
			    			'0.95' => '95%',
			    			'1' => '100%'],['empty' => '--',
			    			'class'=> 'form-control', 'label' => false, 'escape' => false, 'readonly', 'id' => 'tipo_porcentaje']); ?>
			    	</td>
			    	<td>
			    		<?= $this->Form->input('bs', ['type' => 'text', 'label' => false, 'id' => 'bs', 'min' => '0', 'placeholder' => 'Bs', 'class' => 'moneda']); ?>
			    	</td>
			    	<td>
			    		<?= $this->Form->submit('Registrar', ['class'=>'btn btn-default btn-xs']); ?>
			    	</td>
			</tr>
		<?php  endif; ?>
	</table>
	<!---------------------------------------------------------------------------------------------------------------------------->
	<hr>
    
    <table class="table table-responsive">
    	<tr>
    		<td class="pull-left">					    	
				<?= $this->html->Link('Atrás', ['action' => 'recibidascompra'], ['class'=>'btn btn-default pull-right']); ?>
			</td>
			<td>
				<?php if($data['status4'] == true): ?>
					<?= $this->html->Link('Revertir', ['action' => 'revertircompra4', $req, $tipo], ['class'=>'btn btn-info pull-right', 'confirm' => __('Seguro desea revertir la requisicion # {0}?', $req, $tipo)]); ?>
				<?php endif; ?>

				<?php if($data['status4'] == false): ?>
					<?= $this->html->Link('Aprobar', ['action' => 'aprobarcompra4', $req, $tipo], ['class'=>'btn btn-success btn-success pull-right', 'confirm' => __('Seguro que desea procesar la requisicion # {0}?', $req,  $tipo)]); ?>
				<?php endif; ?>
				
			</td>
		</tr>
	</table>
	<!---------------------------------------------------------------------------------------------------------------------------->
	<?= $this->Form->hidden('neto', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'required', 'id' => 'neto', 'readonly', 'value' => @$data['monto']]); ?>
	<?= $this->Form->hidden('id_requisicion', ['type' => 'text', 'label' => false, 'required', 'value' => $requisicion, 'id' => 'id_requisicion']); ?>
	<!---------------------------------------------------------------------------------------------------------------------------->

<?php echo $this->Form->end(); } ?>


<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->


<?php if($data['status2'] == true){ echo $this->Form->create(@$orden, ['class'=>'well']);?>

	<!---------------------------------------------------------------------------------------------------------------------------->

	<?php if ($data['status3'] == true){ ?>
		    <center>
		    	<p style="color: green"> <strong> ORDEN APROBADA </strong> </p>
		    </center>
	<?php } ?>
			<center>
		    	<h4 style="color: green"> <strong> 3ra PARTE </strong> </h4>
		    </center>

	<!---------------------------------------------------------------------------------------------------------------------------->

	<?= $this->Form->hidden('id_requisicion', ['type' => 'text', 'label' => false, 'required', 'value' => $requisicion, 'id' => 'id_requisicion']); ?>

	<?php 
		if(@$data['concepto_mod'] != ''){
			$concepto = @$data['concepto_mod'];
		}else{
			$concepto = @$data['concepto'];
		}
	?> 

	<?php if(count($registros3) == 0){ ?>

		<table class="table table-responsive">
			<tr>
				<td>Observación <?= $this->Form->textarea('observacion', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'rows' => 2, 'onkeyup' => 'mayus(this);']); ?></td>
			</tr>
		</table>

		<table class="table table-responsive">
			<tr>
				<td>Nº de Factura <?= $this->Form->input('n_factura', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off']); ?></td>
				<td>Nº de Control <?= $this->Form->input('n_control', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off']); ?></td>
				<td>Fecha <?= $this->Form->input('fecha', ['label' => false, 'type' => 'date', 'class'=> 'form-control', 'required', 'dateFormat' => 'YMD', 'monthNames' => $meses, 'minYear'=>ANO_FISCAL, 'maxYear'=>ANO_FISCAL]); ?></td>
				<?= $this->Form->hidden('fraccion', ['label' => false, 'type' => 'text', 'required', 'value' => 3, 'readonly']); ?>
			</tr>
		</table>
	<?php }else{ ?>

		<table class="table table-responsive">
			<tr>
				<td>Observación <?= $this->Form->textarea('observacion', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'rows' => 2, 'onkeyup' => 'mayus(this);', 'value' => $registros3[0]['observacion']]); ?></td>
			</tr>
		</table>

		<table class="table table-responsive">
			<tr>
				<td>Nº de Factura <?= $this->Form->input('n_factura', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'readonly', 'value' => $registros3[0]['n_factura']]); ?></td>
				<td>Nº de Control <?= $this->Form->input('n_control', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'readonly', 'value' => $registros3[0]['n_control']]); ?></td>
				<td>Fecha <?= $this->Form->input('fecha', ['label' => false, 'type' => 'date', 'class'=> 'form-control', 'required pattern'=>'[A-Z]{3}[0-9]{4}',  'value' => date_format($registros3[0]['fecha'], "Y/m/d"), 'monthNames' => $meses, 'minYear'=>ANO_FISCAL, 'maxYear'=>ANO_FISCAL, 'readonly']); ?></td>
				<?= $this->Form->hidden('fraccion', ['label' => false, 'type' => 'text', 'required', 'value' => 3, 'readonly']); ?>
			</tr>
		</table>
	<?php } ?>

	<!---------------------------------------------------------------------------------------------------------------------------->
	

	<table class="table table-responsive">
		<thead style="text-align: center;">
	        <tr>
			    <td> <label> Calculo de: </label></td>
			    <td> <label> Porcenataje: </label></td>
			    <td> <label> Monto BsS </label></td>
			    <td> Acción </td>
			</tr>
		</thead>

		<?php

			if(isset($compra[0]['total'])){
				$neto = number_format(($compra[0]['total'] + ($compra[0]['total'] * 0.16)), 2, '.', '');
			}else if(isset($servicio[0]['total'])){
				$neto = number_format(($servicio[0]['total'] + ($servicio[0]['total'] * 0.16)), 2, '.', '');
			}
			$restante = $neto;
		?>

		<?php foreach ($registros3 as $reg) { ?>

			<tr style="text-align: center;">
			    	<td>
			    		<?= $reg->tipo_calculo; ?>
			    	</td>
			    	<td>
			    		<?= ($reg->tipo_porcentaje * 100) . "%" ; ?>
			    	</td>
			    	<td>
			    		<?= number_format($reg->bs, 2, ',', '.') ?>
			    	</td>
			    	<td>
			    		<?php 
				    		if($data['status3'] == false){
				    			echo $this->Html->Link('Eliminar', ['action' => 'deletecompra', $reg->id, $requisicion, $tipo], ['confirm' => __('Desea eliminar este Items?'), 'class' => 'btn btn-danger btn-xs']);
				    		}else{
				    			echo $this->Html->Link('Eliminar', ['action' => 'deletecompra', $reg->id, $requisicion], ['confirm' => __('Desea eliminar este Items?'), 'class' => 'btn btn-danger btn-xs', 'disabled']);
				    		}
			    		?>
			    	</td>
			</tr>
		<?php } ?>
		
		<?php  if($data['status3'] == false): ?>
			<tr style="text-align: center;">
			    	<td>
			    		<?= $this->Form->select('tipo_calculo', $calculo, ['empty' => '--Seleccione--', 'class'=> 'form-control', 'required', 'label' => false, 'escape' => false, 'id' => 'tipo_calculo']); ?>
			    	</td>
			    	<td>
			    		<?= $this->Form->select('tipo_porcentaje', [
			    			'0.008' => '0.80%',
			    			'0.01' => '1%',
			    			'0.02' => '2%',
			    			'0.03' => '3%',
			    			'0.04' => '4%',
			    			'0.05' => '5%',
			    			'0.06' => '6%',
			    			'0.07' => '7%',
			    			'0.08' => '8%',
			    			'0.09' => '9%',
			    			'0.10' => '10%',
			    			'0.15' => '15%',
			    			'0.20' => '20%',
			    			'0.25' => '25%',
			    			'0.30' => '30%',
			    			'0.35' => '35%',
			    			'0.40' => '40%',
			    			'0.45' => '45%',
			    			'0.50' => '50%',
			    			'0.55' => '55%',
			    			'0.60' => '60%',
			    			'0.65' => '65%',
			    			'0.70' => '70%',
			    			'0.75' => '75%',
			    			'0.80' => '80%',
			    			'0.85' => '85%',
			    			'0.90' => '90%',
			    			'0.95' => '95%',
			    			'1' => '100%'],['empty' => '--',
			    			'class'=> 'form-control', 'label' => false, 'escape' => false, 'readonly', 'id' => 'tipo_porcentaje']); ?>
			    	</td>
			    	<td>
			    		<?= $this->Form->input('bs', ['type' => 'text', 'label' => false, 'id' => 'bs', 'min' => '0', 'placeholder' => 'Bs', 'class' => 'moneda']); ?>
			    	</td>
			    	<td>
			    		<?= $this->Form->submit('Registrar', ['class'=>'btn btn-default btn-xs']); ?>
			    	</td>
			</tr>
		<?php  endif; ?>
	</table>
	<!---------------------------------------------------------------------------------------------------------------------------->
	<hr>
    
    <table class="table table-responsive">
    	<tr>
    		<td class="pull-left">					    	
				<?= $this->html->Link('Atrás', ['action' => 'recibidascompra'], ['class'=>'btn btn-default pull-right']); ?>
			</td>
			<td>
				<?php if($data['status3'] == true  and $data['status4'] == false): ?>
					<?= $this->html->Link('Revertir', ['action' => 'revertircompra3', $req, $tipo], ['class'=>'btn btn-info pull-right', 'confirm' => __('Seguro desea revertir la requisicion # {0}?', $req, $tipo)]); ?>
				<?php endif; ?>

				<?php if($data['status3'] == false): ?>
					<?= $this->html->Link('Aprobar', ['action' => 'aprobarcompra3', $req, $tipo], ['class'=>'btn btn-success btn-success pull-right', 'confirm' => __('Seguro que desea procesar la requisicion # {0}?', $req,  $tipo)]); ?>
				<?php endif; ?>
				
			</td>
		</tr>
	</table>
	<!---------------------------------------------------------------------------------------------------------------------------->
	<?= $this->Form->hidden('neto', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'required', 'id' => 'neto', 'readonly', 'value' => @$data['monto']]); ?>
	<?= $this->Form->hidden('id_requisicion', ['type' => 'text', 'label' => false, 'required', 'value' => $requisicion, 'id' => 'id_requisicion']); ?>
	<!---------------------------------------------------------------------------------------------------------------------------->

<?php echo $this->Form->end(); }?>



<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->


<?php if($data['status1'] == true){ echo $this->Form->create(@$orden, ['class'=>'well']);?>

	<!---------------------------------------------------------------------------------------------------------------------------->

	<?php if ($data['status2'] == true){ ?>
		    <center>
		    	<p style="color: green"> <strong> ORDEN APROBADA </strong> </p>
		    </center>
	<?php } ?>
			<center>
		    	<h4 style="color: green"> <strong> 2da PARTE </strong> </h4>
		    </center>

	<!---------------------------------------------------------------------------------------------------------------------------->

	<?= $this->Form->hidden('id_requisicion', ['type' => 'text', 'label' => false, 'required', 'value' => $requisicion, 'id' => 'id_requisicion']); ?>

	<?php 
		if(@$data['concepto_mod'] != ''){
			$concepto = @$data['concepto_mod'];
		}else{
			$concepto = @$data['concepto'];
		}
	?> 

	<?php if(count($registros2) == 0){ ?>

		<table class="table table-responsive">
			<tr>
				<td>Observación <?= $this->Form->textarea('observacion', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'rows' => 2, 'onkeyup' => 'mayus(this);']); ?></td>
			</tr>
		</table>

		<table class="table table-responsive">
			<tr>
				<td>Nº de Factura <?= $this->Form->input('n_factura', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off']); ?></td>
				<td>Nº de Control <?= $this->Form->input('n_control', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off']); ?></td>
				<td>Fecha <?= $this->Form->input('fecha', ['label' => false, 'type' => 'date', 'class'=> 'form-control', 'required', 'dateFormat' => 'YMD', 'monthNames' => $meses, 'minYear'=>ANO_FISCAL, 'maxYear'=>ANO_FISCAL]); ?></td>
				<?= $this->Form->hidden('fraccion', ['label' => false, 'type' => 'text', 'required', 'value' => 2, 'readonly']); ?>
			</tr>
		</table>
	<?php }else{ ?>

		<table class="table table-responsive">
			<tr>
				<td>Observación <?= $this->Form->textarea('observacion', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'rows' => 2, 'onkeyup' => 'mayus(this);', 'value' => $registros2[0]['observacion']]); ?></td>
			</tr>
		</table>

		<table class="table table-responsive">
			<tr>
				<td>Nº de Factura <?= $this->Form->input('n_factura', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'readonly', 'value' => $registros2[0]['n_factura']]); ?></td>
				<td>Nº de Control <?= $this->Form->input('n_control', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'readonly', 'value' => $registros2[0]['n_control']]); ?></td>
				<td>Fecha <?= $this->Form->input('fecha', ['label' => false, 'type' => 'date', 'class'=> 'form-control', 'required pattern'=>'[A-Z]{3}[0-9]{4}',  'value' => date_format($registros2[0]['fecha'], "Y/m/d"), 'monthNames' => $meses, 'minYear'=>ANO_FISCAL, 'maxYear'=>ANO_FISCAL, 'readonly']); ?></td>
				<?= $this->Form->hidden('fraccion', ['label' => false, 'type' => 'text', 'required', 'value' => 2, 'readonly']); ?>
			</tr>
		</table>
	<?php } ?>

	<!---------------------------------------------------------------------------------------------------------------------------->
	

	<table class="table table-responsive">
		<thead style="text-align: center;">
	        <tr>
			    <td> <label> Calculo de: </label></td>
			    <td> <label> Porcenataje: </label></td>
			    <td> <label> Monto BsS </label></td>
			    <td> Acción </td>
			</tr>
		</thead>

		<?php

			if(isset($compra[0]['total'])){
				$neto = number_format(($compra[0]['total'] + ($compra[0]['total'] * 0.16)), 2, '.', '');
			}else if(isset($servicio[0]['total'])){
				$neto = number_format(($servicio[0]['total'] + ($servicio[0]['total'] * 0.16)), 2, '.', '');
			}
			$restante = $neto;
		?>

		<?php foreach ($registros2 as $reg) { ?>

			<tr style="text-align: center;">
			    	<td>
			    		<?= $reg->tipo_calculo; ?>
			    	</td>
			    	<td>
			    		<?= ($reg->tipo_porcentaje * 100) . "%" ; ?>
			    	</td>
			    	<td>
			    		<?= number_format($reg->bs, 2, ',', '.') ?>
			    	</td>
			    	<td>
			    		<?php 
				    		if($data['status2'] == false){
				    			echo $this->Html->Link('Eliminar', ['action' => 'deletecompra', $reg->id, $requisicion, $tipo], ['confirm' => __('Desea eliminar este Items?'), 'class' => 'btn btn-danger btn-xs']);
				    		}else{
				    			echo $this->Html->Link('Eliminar', ['action' => 'deletecompra', $reg->id, $requisicion], ['confirm' => __('Desea eliminar este Items?'), 'class' => 'btn btn-danger btn-xs', 'disabled']);
				    		}
			    		?>
			    	</td>
			</tr>
		<?php } ?>
		
		<?php  if($data['status2'] == false): ?>
			<tr style="text-align: center;">
			    	<td>
			    		<?= $this->Form->select('tipo_calculo', $calculo, ['empty' => '--Seleccione--', 'class'=> 'form-control', 'required', 'label' => false, 'escape' => false, 'id' => 'tipo_calculo']); ?>
			    	</td>
			    	<td>
			    		<?= $this->Form->select('tipo_porcentaje', [
			    			'0.008' => '0.80%',
			    			'0.01' => '1%',
			    			'0.02' => '2%',
			    			'0.03' => '3%',
			    			'0.04' => '4%',
			    			'0.05' => '5%',
			    			'0.06' => '6%',
			    			'0.07' => '7%',
			    			'0.08' => '8%',
			    			'0.09' => '9%',
			    			'0.10' => '10%',
			    			'0.15' => '15%',
			    			'0.20' => '20%',
			    			'0.25' => '25%',
			    			'0.30' => '30%',
			    			'0.35' => '35%',
			    			'0.40' => '40%',
			    			'0.45' => '45%',
			    			'0.50' => '50%',
			    			'0.55' => '55%',
			    			'0.60' => '60%',
			    			'0.65' => '65%',
			    			'0.70' => '70%',
			    			'0.75' => '75%',
			    			'0.80' => '80%',
			    			'0.85' => '85%',
			    			'0.90' => '90%',
			    			'0.95' => '95%',
			    			'1' => '100%'],['empty' => '--',
			    			'class'=> 'form-control', 'label' => false, 'escape' => false, 'readonly', 'id' => 'tipo_porcentaje']); ?>
			    	</td>
			    	<td>
			    		<?= $this->Form->input('bs', ['type' => 'text', 'label' => false, 'id' => 'bs', 'min' => '0', 'placeholder' => 'Bs', 'class' => 'moneda']); ?>
			    	</td>
			    	<td>
			    		<?= $this->Form->submit('Registrar', ['class'=>'btn btn-default btn-xs']); ?>
			    	</td>
			</tr>
		<?php  endif; ?>
	</table>
	<!---------------------------------------------------------------------------------------------------------------------------->
	<hr>
    
    <table class="table table-responsive">
    	<tr>
    		<td class="pull-left">					    	
				<?= $this->html->Link('Atrás', ['action' => 'recibidascompra'], ['class'=>'btn btn-default pull-right']); ?>
			</td>
			<td>
				<?php if($data['status2'] == true and $data['status3'] == false): ?>
					<?= $this->html->Link('Revertir', ['action' => 'revertircompra2', $req, $tipo], ['class'=>'btn btn-info pull-right', 'confirm' => __('Seguro desea revertir la requisicion # {0}?', $req, $tipo)]); ?>
				<?php endif; ?>

				<?php if($data['status2'] == false): ?>
					<?= $this->html->Link('Aprobar', ['action' => 'aprobarcompra2', $req, $tipo], ['class'=>'btn btn-success btn-success pull-right', 'confirm' => __('Seguro que desea procesar la requisicion # {0}?', $req,  $tipo)]); ?>
				<?php endif; ?>
				
			</td>
		</tr>
	</table>
	<!---------------------------------------------------------------------------------------------------------------------------->
	<?= $this->Form->hidden('neto', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'required', 'id' => 'neto', 'readonly', 'value' => @$data['monto']]); ?>
	<?= $this->Form->hidden('id_requisicion', ['type' => 'text', 'label' => false, 'required', 'value' => $requisicion, 'id' => 'id_requisicion']); ?>
	<!---------------------------------------------------------------------------------------------------------------------------->

<?php echo $this->Form->end(); }?>



<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->

<?= $this->Form->create(@$orden, ['class'=>'well']);?>
	<table class="table table-responsive">
		<thead>
			<tr>
				<th></th>
				<th class="text-center"><strong>Requisicion Ordenamiento <?= $req ?></strong></th>
				<th></th>
			</tr>
		</thead>
	</table>

	<!---------------------------------------------------------------------------------------------------------------------------->

	<?php if ($data['status'] == 5 and $data['status1'] == true){ ?>
		    <center>
		    	<p style="color: green"> <strong> ORDEN APROBADA </strong> </p>
		    </center>
	<?php } ?>

	<!---------------------------------------------------------------------------------------------------------------------------->

	<?= $this->Form->hidden('id_requisicion', ['type' => 'text', 'label' => false, 'required', 'value' => $requisicion, 'id' => 'id_requisicion']); ?>

	<?php 
		if(@$data['concepto_mod'] != ''){
			$concepto = @$data['concepto_mod'];
		}else{
			$concepto = @$data['concepto'];
		}
	?> 

	<?php if(count($registros1) == 0){ ?>

		<table class="table table-responsive">
			<tr>
				<td>Concepto <?= $this->Form->textarea('concepto', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'value' => @$concepto, 'rows' => 2, 'onkeyup' => 'mayus(this);']); ?></td>
			</tr>
		</table>

		<table class="table table-responsive">
			<tr>
				<td>Observación <?= $this->Form->textarea('observacion', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'rows' => 2, 'onkeyup' => 'mayus(this);']); ?></td>
			</tr>
		</table>

		<table class="table table-responsive">
			<tr>
				<td>Nº de Factura <?= $this->Form->input('n_factura', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off']); ?></td>
				<td>Nº de Control <?= $this->Form->input('n_control', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off']); ?></td>
				<td>Fecha <?= $this->Form->input('fecha', ['label' => false, 'type' => 'date', 'class'=> 'form-control', 'required', 'dateFormat' => 'YMD', 'monthNames' => $meses, 'minYear'=>ANO_FISCAL, 'maxYear'=>ANO_FISCAL]); ?></td>
				<?= $this->Form->hidden('fraccion', ['label' => false, 'type' => 'text', 'required', 'value' => 1, 'readonly']); ?>
			</tr>
		</table>
	<?php }else{ ?>
		<table class="table table-responsive">
			<tr>
				<td>Concepto <?= $this->Form->textarea('concepto', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'value' => @$concepto, 'readonly']); ?></td>
			</tr>
		</table>

		<table class="table table-responsive">
			<tr>
				<td>Observación <?= $this->Form->textarea('observacion', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'rows' => 2, 'onkeyup' => 'mayus(this);', 'value' => $registros1[0]['observacion'], 'readonly']); ?></td>
			</tr>
		</table>

		<table class="table table-responsive">
			<tr>
				<td>Nº de Factura <?= $this->Form->input('n_factura', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'readonly', 'value' => $registros1[0]['n_factura']]); ?></td>
				<td>Nº de Control <?= $this->Form->input('n_control', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'autocomplete' => 'off', 'readonly', 'value' => $registros1[0]['n_control']]); ?></td>
				<td>Fecha <?= $this->Form->input('fecha', ['label' => false, 'type' => 'date', 'class'=> 'form-control', 'required pattern'=>'[A-Z]{3}[0-9]{4}',  'value' => date_format($registros1[0]['fecha'], "Y/m/d"), 'monthNames' => $meses, 'minYear'=>ANO_FISCAL, 'maxYear'=>ANO_FISCAL, 'readonly']); ?></td>
				<?= $this->Form->hidden('fraccion', ['label' => false, 'type' => 'text', 'required', 'value' => 1, 'readonly']); ?>
			</tr>
		</table>
	<?php } ?>

	<!---------------------------------------------------------------------------------------------------------------------------->
	

	<table class="table table-responsive">
		<thead style="text-align: center;">
	        <tr>
			    <td> <label> Calculo de: </label></td>
			    <td> <label> Porcenataje: </label></td>
			    <td> <label> Monto BsS </label></td>
			    <td> Acción </td>
			</tr>
		</thead>

		<?php

			if(isset($compra[0]['total'])){
				$neto = number_format(($compra[0]['total'] + ($compra[0]['total'] * 0.16)), 2, '.', '');
			}else if(isset($servicio[0]['total'])){
				$neto = number_format(($servicio[0]['total'] + ($servicio[0]['total'] * 0.16)), 2, '.', '');
			}
			$restante = $neto;
		?>

		<?php foreach ($registros1 as $reg) { ?>

			<tr style="text-align: center;">
			    	<td>
			    		<?= $reg->tipo_calculo; ?>
			    	</td>
			    	<td>
			    		<?= ($reg->tipo_porcentaje * 100) . "%" ; ?>
			    	</td>
			    	<td>
			    		<?= number_format($reg->bs, 2, ',', '.') ?>
			    	</td>
			    	<td>
			    		<?php 
				    		if($data['status1'] == false){
				    			echo $this->Html->Link('Eliminar', ['action' => 'deletecompra', $reg->id, $requisicion, $tipo], ['confirm' => __('Desea eliminar este Items?'), 'class' => 'btn btn-danger btn-xs']);
				    		}else{
				    			echo $this->Html->Link('Eliminar', ['action' => 'deletecompra', $reg->id, $requisicion], ['confirm' => __('Desea eliminar este Items?'), 'class' => 'btn btn-danger btn-xs', 'disabled']);
				    		}
			    		?>
			    	</td>
			</tr>
		<?php } ?>
		
		<?php  if($data['status1'] == false): ?>
			<tr style="text-align: center;">
			    	<td>
			    		<?= $this->Form->select('tipo_calculo', $calculo, ['empty' => '--Seleccione--', 'class'=> 'form-control', 'required', 'label' => false, 'escape' => false, 'id' => 'tipo_calculo']); ?>
			    	</td>
			    	<td>
			    		<?= $this->Form->select('tipo_porcentaje', [
			    			'0.008' => '0.80%',
			    			'0.01' => '1%',
			    			'0.02' => '2%',
			    			'0.03' => '3%',
			    			'0.04' => '4%',
			    			'0.05' => '5%',
			    			'0.06' => '6%',
			    			'0.07' => '7%',
			    			'0.08' => '8%',
			    			'0.09' => '9%',
			    			'0.10' => '10%',
			    			'0.15' => '15%',
			    			'0.20' => '20%',
			    			'0.25' => '25%',
			    			'0.30' => '30%',
			    			'0.35' => '35%',
			    			'0.40' => '40%',
			    			'0.45' => '45%',
			    			'0.50' => '50%',
			    			'0.55' => '55%',
			    			'0.60' => '60%',
			    			'0.65' => '65%',
			    			'0.70' => '70%',
			    			'0.75' => '75%',
			    			'0.80' => '80%',
			    			'0.85' => '85%',
			    			'0.90' => '90%',
			    			'0.95' => '95%',
			    			'1' => '100%'],['empty' => '--',
			    			'class'=> 'form-control', 'label' => false, 'escape' => false, 'readonly', 'id' => 'tipo_porcentaje']); ?>
			    	</td>
			    	<td>
			    		<?= $this->Form->input('bs', ['type' => 'text', 'label' => false, 'id' => 'bs', 'min' => '0', 'placeholder' => 'Bs', 'class' => 'moneda']); ?>
			    	</td>
			    	<td>
			    		<?= $this->Form->submit('Registrar', ['class'=>'btn btn-default btn-xs']); ?>
			    	</td>
			</tr>
		<?php  endif; ?>
	</table>
	<!---------------------------------------------------------------------------------------------------------------------------->
	<hr>
    
    <table class="table table-responsive">
    	<tr>
    		<td class="pull-left">					    	
				<?= $this->html->Link('Atrás', ['action' => 'recibidascompra'], ['class'=>'btn btn-default pull-right']); ?>
			</td>
			<td>
				<?php if($data['status'] == 5 and $data['status1'] == true and $data['status2'] == false): ?>
					<?= $this->html->Link('Revertir', ['action' => 'revertircompra1', $req, $tipo], ['class'=>'btn btn-info pull-right', 'confirm' => __('Seguro desea revertir la requisicion # {0}?', $req, $tipo)]); ?>
				<?php endif; ?>

					<?= $this->html->Link('Aprobar', ['action' => 'aprobarcompra1', $req, $tipo], ['class'=>'btn btn-success btn-success pull-right', 'confirm' => __('Seguro que desea procesar la requisicion # {0}?', $req,  $tipo)]); ?>
					<?= $this->html->Link('Rechazar', ['action' => 'rechazarcompra', $req,  $tipo], ['class'=>'btn btn-danger pull-right', 'confirm' => __('Seguro desea rechazar la requisicion # {0}?', $req, $tipo)]); ?>
				
			</td>
		</tr>
	</table>
	<!---------------------------------------------------------------------------------------------------------------------------->
	<?= $this->Form->hidden('neto', ['type' => 'text', 'label' => false, 'class'=> 'form-control', 'required', 'id' => 'neto', 'readonly', 'value' => @$data['monto']]); ?>
	<?= $this->Form->hidden('id_requisicion', ['type' => 'text', 'label' => false, 'required', 'value' => $requisicion, 'id' => 'id_requisicion']); ?>
	<!---------------------------------------------------------------------------------------------------------------------------->

<?php echo $this->Form->end(); ?>


